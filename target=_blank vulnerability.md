# target="\_blank" vulnerability

## Attack scenario

1. Suppose the victim uses Facebook which is known for opening links via `target="_blank"`
2. Create a fake viral page
3. Create a phishing website that looks like Facebook sign in
4. Put below code on viral page e.g. via found XSS vulnerability
   ```
   window.opener.location = 'https://phishing-website/facebook.com';
   ```
5. The victim clicks on link on Facebook to the viral page
6. The viral page redirects the Facebook tab to the phishing website asking the user to sign in again

So we can change the "parent" tab from infected "children" page by `window` object from Web API. Typically, an attack involves using several found vulnerabilities and phishing scams in parallel. Note that modern browsers can make `window.opener` function in child tab as `null` to prevent this behavior.

## Example code

```html
<a href="https://github.com" target="_blank">Go to GitHub - infected link</a>
```

```js
const link = document.getElementsByTagName('a')
if (link)
  link[0].onclick = () => {
    if (window) window.opener.location = 'https://stackoverflow.com'
  }
```

Above is the infected link which originally opens a new tab with GitHub page but meanwhile it changes our "parent" page to Stackoverflow site.

## Live example

https://codesandbox.io/s/targetblank-vulnerability-r8uij

## Defense methods

1. HTML

   Add `rel="noopener noreferrer"` to `<a>` tag

2. JavaScript

   Add `window.opener = null` after `window.open()`
